# WoW Economy Forecaster — Default Configuration
# This file is committed to git. Use config/local.toml (gitignored) for local overrides.
# Use .env for secrets (API keys, etc.). See .env.example.

[project]
name    = "wow-economy-forecaster"
version = "0.1.0"
debug   = false

# ── Database ──────────────────────────────────────────────────────────────────

[database]
# Path relative to project root (or absolute)
db_path = "data/db/wow_forecaster.db"
# WAL journal mode enables concurrent reads during pipeline runs
wal_mode = true
# Milliseconds to wait when DB is locked before raising OperationalError
busy_timeout_ms = 5000

# ── Data Directories ──────────────────────────────────────────────────────────

[data]
raw_dir           = "data/raw"
processed_dir     = "data/processed"
events_seed_file  = "config/events/tww_events.json"

# ── Expansions ────────────────────────────────────────────────────────────────

[expansions]
known = [
    "classic", "tbc", "wotlk", "cata", "mop", "wod",
    "legion", "bfa", "shadowlands", "dragonflight", "tww", "midnight",
]
# Expansion to ingest data FROM (source of historical patterns)
active = "tww"
# Expansion to transfer patterns TO (forecast target)
transfer_target = "midnight"

# ── Realms ────────────────────────────────────────────────────────────────────

[realms]
# Default realm slugs to track when none specified on CLI
# US high-pop realms covering both Alliance and Horde player bases
defaults = ["area-52", "illidan", "stormrage", "tichondrius"]
# AH faction: "neutral" = commodity AH (most accurate for commodities)
default_faction = "neutral"

# ── Pipeline ──────────────────────────────────────────────────────────────────

[pipeline]
# How many raw observations to process per normalize batch
normalize_batch_size = 1000
# Z-score threshold for outlier detection (|z| > threshold → is_outlier=True)
outlier_z_threshold = 3.0
# Minimum observations required to build a usable feature vector
min_obs_for_feature = 30

# ── Forecast ──────────────────────────────────────────────────────────────────

[forecast]
# Time horizons to generate forecasts for (Nd, Nw, or Nm format)
horizons = ["1d", "7d", "30d"]
# Confidence interval level (0.80 = 80% CI)
confidence_pct = 0.80
# Default model slug used until real models are trained
default_model_slug = "stub_linear_v0"

# ── Logging ───────────────────────────────────────────────────────────────────

[logging]
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
level = "INFO"
# Log file (relative to project root); set to "" to disable file logging
log_file = "data/logs/forecaster.log"
# Structured JSON logging (useful for future log aggregation)
json_format = false

# ── Backtest ──────────────────────────────────────────────────────────────────

[backtest]
# Walk-forward window size in days (training window for each fold)
window_days = 30
# Step size between consecutive walk-forward windows
step_days = 7
# Forecast horizons in days to evaluate (1d = next-day price, 3d = 3-day-ahead price)
horizons_days = [1, 3]
# Minimum number of non-null training rows required before fitting a model on a series
min_train_rows = 14

# ── Feature Engineering ───────────────────────────────────────────────────────

[features]
# Lag windows (in days) to compute as lookback features
lag_days = [1, 3, 7, 14, 28]
# Rolling windows (in days) for mean + std features, and momentum pct-change
rolling_windows = [7, 14, 28]
# Archetype series with fewer observations than this are flagged is_cold_start=True
cold_start_threshold = 30
# Default number of calendar days to look back when building the training window
training_lookback_days = 180
# Forward-looking price horizons (in days) to use as training targets
target_horizons_days = [1, 7, 28]

# ── ML Model ──────────────────────────────────────────────────────────────────

[model]
# Model architecture: "lightgbm" (only option in v0.5.0)
model_type = "lightgbm"
# LightGBM tree complexity (max leaves per tree; higher = more complex)
num_leaves = 31
# Gradient boosting step size; lower = slower convergence but better generalisation
learning_rate = 0.05
# Maximum number of boosting rounds (early stopping may reduce this)
n_estimators = 100
# Minimum observations per leaf (critical for thin archetype series)
min_child_samples = 5
# Fraction of features sampled per tree (reduces overfitting, speeds training)
feature_fraction = 0.8
# Fraction of rows sampled per boosting round (bagging)
bagging_fraction = 0.8
# Apply bagging every N rounds (0 = disable bagging)
bagging_freq = 5
# Stop early if val MAE does not improve for N rounds
early_stopping_rounds = 20
# Number of trailing days to hold out as the time-based validation set
validation_split_days = 14
# Where trained model artifacts (.pkl + .json) are written
artifact_dir = "data/outputs/model_artifacts"
# Where daily forecast CSV/JSON reports are written
forecast_output_dir = "data/outputs/forecasts"
# Where recommendation CSV/JSON reports are written
recommendation_output_dir = "data/outputs/recommendations"
# Maximum recommendations returned per archetype category
top_n_per_category = 3

# ── Monitoring & Drift Detection ───────────────────────────────────────────────

[monitoring]
# Recent observation window for data drift detection (hours).
# 25h = one hourly cycle with jitter tolerance.
drift_window_hours = 25

# Historical baseline window for data drift (days).
drift_baseline_days = 30

# Z-score threshold for flagging an individual series as drifted.
# 2.0 = mean must shift by 2 std from 30-day baseline to be flagged.
drift_z_threshold = 2.0

# Error drift: how many recent days of live forecasts to evaluate.
error_drift_window_days = 7

# Error drift MAE ratio thresholds (live_mae / baseline_mae).
# LOW:      20-50% increase — watch and wait
error_drift_mae_ratio_low = 1.2
# MEDIUM:   50-100% increase — retrain recommended
error_drift_mae_ratio_medium = 1.5
# HIGH:     100-200% increase — model stale
error_drift_mae_ratio_high = 2.0
# CRITICAL: >200% increase — model broken
error_drift_mae_ratio_critical = 3.0

# Event shock: look-ahead window for upcoming major events (days).
event_shock_window_days = 7

# Auto-retrain on CRITICAL drift (off by default — manual review preferred).
auto_retrain_on_critical = false

# Directory for monitoring JSON output files.
monitoring_output_dir = "data/outputs/monitoring"
